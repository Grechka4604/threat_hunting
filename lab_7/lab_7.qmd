---
title: "pr 07 sokolov"
author: "sokol46532@yandex.ru"
format: 
  md:
    output-file: README.md
---

## Цель работы

1. Изучить возможности технологии Yandex Query для анализа структурированных наборов данных.
2. Получить навыки построения аналитического пайплайна для анализа данных с помощью сервисов Yandex Cloud.
3. Закрепить практические навыки использования SQL для анализа данных сетевой активности в сегментированной корпоративной сети.

## Исходные данные

1. Программное обеспечение: ОС Windows 10
2. RStudio
3. Интерпретатор языка R 4.5.2

## Задание

Используя сервис Yandex Query настроить доступ к данным, хранящимся в сервисе хранения данных Yandex Object Storage. При помощи SQL-запросов ответить на поставленные вопросы.

## План

1. Проверить доступность данных в Yandex Object Storage.
2. Подключить бакет как источник данных для Yandex Query.
3. Выполнить анализ данных с помощью SQL:
   3.1 Известно, что IP-адреса внутренней сети начинаются с октетов в диапазоне **[12–14]**. Определить количество хостов внутренней сети, представленных в датасете.
   3.2 Определить суммарный объём исходящего трафика.
   3.3 Определить суммарный объём входящего трафика.

## Шаги

### Шаг 1. Проверка доступности данных в Yandex Object Storage

Откроем публичный каталог по ссылке [https://storage.yandexcloud.net/arrow-datasets](https://storage.yandexcloud.net/arrow-datasets) и убедимся, что в нём присутствует файл **yaqry_dataset.pqt** (Parquet).

![](./img/1.png)

### Шаг 2. Подключение бакета как источника данных в Yandex Query

Создадим подключение к бакету в S3-совместимом хранилище (Yandex Object Storage), чтобы Yandex Query мог читать данные напрямую из Object Storage.

![](./img/2.png)

Заполним параметры соединения и привяжем источник к данным в бакете.

![](./img/3.png)

Настроим структуру таблицы и сопоставим колонки, чтобы данные интерпретировались корректно.

![](./img/5.png)

При необходимости приведём столбцы времени к типу **TIMESTAMP**, указав преобразование на основе заданных колонок.

![](./img/4.png)

Проверим, что подключение успешно создано и тестовые запросы выполняются без ошибок.

![](./img/6.png)

### Шаг 3. Анализ данных SQL-запросами

#### 3.1 Количество хостов внутренней сети

Согласно условию, внутренние IP-адреса начинаются с октетов **12–14**. Выполним запрос, который:
```
SELECT 
  COUNT(DISTINCT ip_address) AS valid_addresses
FROM (
  SELECT 
    dst AS ip_address 
  FROM 
    `arrow_bind_isokolov`
    
  UNION ALL
  
  SELECT 
    src AS ip_address 
  FROM 
    `arrow_bind_isokolov`
) t
WHERE 
  ip_address REGEXP '^1[2-4]\\.';
```
![](./img/7.png)

#### 3.2 Суммарный объём исходящего трафика

Выполним SQL-запрос на суммирование исходящего трафика (outgoing / bytes_out — в зависимости от схемы набора данных).
```
SELECT 
  SUM(bytes) AS bytes_total
FROM 
  `arrow_bind_isokolov`
WHERE 
  src REGEXP '^1[2-4]\\.'
  AND dst NOT REGEXP '^1[2-4]\\.';
```

![](./img/8.png)

#### 3.3 Суммарный объём входящего трафика

Аналогично рассчитаем суммарный входящий трафик (incoming / bytes_in).

```
SELECT SUM(bytes)
    FROM `arrow_bind_isokolov` 
WHERE 
    src NOT REGEXP '^1[2-4]\.' 
    AND dst REGEXP '^1[2-4]\.'
```

![](./img/9.png)

## Оценка результата

В рамках практической работы было отработано подключение данных из Yandex Object Storage к Yandex Query и выполнен базовый анализ сетевой активности SQL-запросами.

## Вывод

В ходе практической работы были изучены сервисы Yandex Cloud, рассмотрены возможности Yandex Query для анализа структурированных наборов данных, а также закреплены практические навыки работы с S3-хранилищем и написания SQL-запросов для расчёта ключевых метрик трафика.
